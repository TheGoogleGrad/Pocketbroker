<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PocketBroker ‚Äî Deal Analyzer</title>
<meta name="description" content="Fast CRE deal analysis in your pocket">
<meta name="theme-color" content="#0a0c10">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="PocketBroker">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="pocketbroker.webmanifest">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='22' fill='%230a0c10'/><text y='68' x='50' text-anchor='middle' font-size='54' font-family='sans-serif' font-weight='900' fill='%234f8ef7'>P</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c10;
    --surface: #12151c;
    --surface2: #1a1f2a;
    --border: #252b38;
    --border-bright: #3a4256;
    --accent: #4f8ef7;
    --accent2: #38d9a9;
    --accent3: #f7c948;
    --danger: #f76e6e;
    --text: #e8ecf4;
    --text2: #8892a4;
    --text3: #4f5a6e;
    --mono: 'DM Mono', monospace;
    --sans: 'DM Sans', sans-serif;
    --display: 'Syne', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--sans);
    min-height: 100vh;
    overscroll-behavior: none;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .logo {
    font-family: var(--display);
    font-weight: 800;
    font-size: 20px;
    letter-spacing: -0.5px;
    color: var(--text);
  }
  .logo span { color: var(--accent); }
  .tagline {
    font-size: 11px;
    color: var(--text3);
    font-family: var(--mono);
    letter-spacing: 0.05em;
  }
  .reset-btn {
    background: none;
    border: 1px solid var(--border);
    color: var(--text2);
    font-family: var(--mono);
    font-size: 11px;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .reset-btn:hover { border-color: var(--danger); color: var(--danger); }

  /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
  .tabs {
    display: flex;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 20px;
    gap: 0;
  }
  .tab {
    flex: 1;
    padding: 12px 8px;
    text-align: center;
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text3);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
  }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  .main { max-width: 600px; margin: 0 auto; padding: 20px; padding-bottom: 120px; }

  /* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
  .panel { display: none; }
  .panel.active { display: block; }

  /* ‚îÄ‚îÄ SECTION ‚îÄ‚îÄ */
  .section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
  }
  .section-header {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .section-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--text2);
  }
  .section-badge {
    font-family: var(--mono);
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 4px;
    background: var(--surface2);
    color: var(--text2);
  }

  /* ‚îÄ‚îÄ FIELD ‚îÄ‚îÄ */
  .field {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .field:last-child { border-bottom: none; }
  .field-label {
    flex: 1;
    font-size: 13px;
    color: var(--text2);
    font-weight: 400;
  }
  .field-label small {
    display: block;
    font-size: 11px;
    color: var(--text3);
    margin-top: 1px;
    font-family: var(--mono);
  }
  .field-input-wrap {
    display: flex;
    align-items: center;
    background: #e8eaf0;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: border-color 0.15s;
    min-width: 130px;
  }
  .field-input-wrap:focus-within { border-color: var(--accent); }
  .field-prefix, .field-suffix {
    padding: 0 10px;
    font-family: var(--mono);
    font-size: 13px;
    color: var(--text3);
    background: var(--surface);
    height: 40px;
    display: flex;
    align-items: center;
    border-right: 1px solid var(--border);
    flex-shrink: 0;
  }
  .field-suffix { border-right: none; border-left: 1px solid var(--border); }
  .field-input-wrap input {
    background: #e8eaf0;
    border: none;
    outline: none;
    color: #1a1f2e;
    font-family: var(--mono);
    font-size: 14px;
    font-weight: 500;
    padding: 0 10px;
    height: 40px;
    width: 100%;
    min-width: 0;
  }
  .field-input-wrap input::placeholder { color: var(--text3); }
  input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }

  /* ‚îÄ‚îÄ UNIT ROWS ‚îÄ‚îÄ */
  .unit-row {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    display: grid;
    grid-template-columns: 28px 1fr 90px 90px auto;
    gap: 6px;
    align-items: center;
  }
  .yr2-input {
    background: rgba(56,217,169,0.08);
    border: 1px solid rgba(56,217,169,0.25);
    border-radius: 6px;
    color: var(--accent2);
    font-family: var(--mono);
    font-size: 12px;
    padding: 6px 6px 6px 18px;
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
    height: 34px;
  }
  .yr2-input:focus { border-color: var(--accent2); }
  .yr2-input::placeholder { color: rgba(56,217,169,0.3); }
  .yr2-input:disabled { opacity: 0.4; background: var(--surface2); border-color: var(--border); color: var(--text3); }
  .global-increase-bar {
    padding: 10px 16px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .apply-all-label {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text3);
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    user-select: none;
  }
  .apply-all-label input[type=checkbox] { accent-color: var(--accent2); width: 14px; height: 14px; cursor: pointer; }
  .yr2-pct-wrap {
    display: flex;
    align-items: center;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
    height: 30px;
  }
  .yr2-pct-wrap input {
    background: none;
    border: none;
    outline: none;
    color: var(--accent2);
    font-family: var(--mono);
    font-size: 12px;
    font-weight: 600;
    padding: 0 6px;
    width: 52px;
    height: 30px;
  }
  .yr2-pct-wrap span {
    padding: 0 8px;
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text3);
    background: var(--surface2);
    height: 30px;
    display: flex;
    align-items: center;
    border-left: 1px solid var(--border);
  }
  .unit-row:last-child { border-bottom: none; }
  .unit-num {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text3);
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: var(--surface2);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .unit-input {
    background: #e8eaf0;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: #1a1f2e;
    font-family: var(--mono);
    font-size: 13px;
    padding: 6px 10px;
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
  }
  .unit-input:focus { border-color: var(--accent); }
  .unit-input::placeholder { color: var(--text3); }
  .unit-select {
    background: #e8eaf0;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: #1a1f2e;
    font-family: var(--mono);
    font-size: 12px;
    padding: 6px 28px 6px 10px;
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%234f5a6e' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    cursor: pointer;
    height: 34px;
  }
  .unit-select:focus { border-color: var(--accent); }
  .unit-select option { background: #1a1f2a; color: var(--text); }
  .unit-remove {
    background: none;
    border: none;
    color: var(--text3);
    cursor: pointer;
    font-size: 16px;
    padding: 4px;
    line-height: 1;
    transition: color 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
  }
  .unit-remove:hover { color: var(--danger); }

  .add-btn {
    width: 100%;
    padding: 12px;
    background: none;
    border: none;
    border-top: 1px solid var(--border);
    color: var(--accent);
    font-family: var(--mono);
    font-size: 12px;
    cursor: pointer;
    transition: background 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  .add-btn:hover { background: var(--surface2); }

  /* ‚îÄ‚îÄ EXPENSES ‚îÄ‚îÄ */
  .expense-row {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    display: grid;
    grid-template-columns: 1fr 120px auto auto;
    gap: 8px;
    align-items: center;
  }
  .expense-row:last-child { border-bottom: none; }
  .expense-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
  }
  .toggle {
    width: 32px;
    height: 18px;
    background: var(--border);
    border-radius: 9px;
    position: relative;
    transition: background 0.15s;
    flex-shrink: 0;
  }
  .toggle.on { background: var(--accent2); }
  .toggle::after {
    content: '';
    position: absolute;
    width: 12px;
    height: 12px;
    background: white;
    border-radius: 50%;
    top: 3px;
    left: 3px;
    transition: transform 0.15s;
  }
  .toggle.on::after { transform: translateX(14px); }
  .expense-name {
    font-size: 13px;
    color: var(--text2);
  }
  .expense-name.off { color: var(--text3); text-decoration: line-through; }
  .expense-input {
    background: #e8eaf0;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: #1a1f2e;
    font-family: var(--mono);
    font-size: 13px;
    padding: 6px 10px;
    outline: none;
    width: 100%;
    transition: border-color 0.15s;
  }
  .expense-input:focus { border-color: var(--accent); }
  .expense-type-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text3);
    font-family: var(--mono);
    font-size: 11px;
    padding: 6px 8px;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s;
  }
  .expense-type-btn:hover { border-color: var(--accent); color: var(--accent); }
  .expense-remove {
    background: none;
    border: none;
    color: var(--text3);
    cursor: pointer;
    font-size: 16px;
    width: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.15s;
  }
  .expense-remove:hover { color: var(--danger); }

  /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
  .results-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }
  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .result-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }
  .result-card.blue::before { background: var(--accent); }
  .result-card.green::before { background: var(--accent2); }
  .result-card.gold::before { background: var(--accent3); }
  .result-card.red::before { background: var(--danger); }
  .result-label {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text3);
    margin-bottom: 8px;
  }
  .result-value {
    font-family: var(--display);
    font-weight: 800;
    font-size: 26px;
    letter-spacing: -1px;
    line-height: 1;
    margin-bottom: 4px;
  }
  .result-card.blue .result-value { color: var(--accent); }
  .result-card.green .result-value { color: var(--accent2); }
  .result-card.gold .result-value { color: var(--accent3); }
  .result-card.red .result-value { color: var(--danger); }
  .result-sub {
    font-size: 11px;
    color: var(--text3);
    font-family: var(--mono);
  }

  /* ‚îÄ‚îÄ WATERFALL ‚îÄ‚îÄ */
  .waterfall {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .wf-row {
    padding: 11px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }
  .wf-row:last-child { border-bottom: none; }
  .wf-row.total {
    background: var(--surface2);
    font-weight: 600;
  }
  .wf-label { color: var(--text2); }
  .wf-label.indent { padding-left: 16px; color: var(--text3); font-size: 12px; }
  .wf-value { font-family: var(--mono); font-size: 13px; font-weight: 500; }
  .wf-value.neg { color: var(--danger); }
  .wf-value.pos { color: var(--accent2); }
  .wf-value.highlight { color: var(--accent); }

  /* ‚îÄ‚îÄ LOAN SECTION ‚îÄ‚îÄ */
  .loan-toggle-row {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }
  .loan-toggle-label {
    font-size: 13px;
    color: var(--text2);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* ‚îÄ‚îÄ PROPERTY INFO ‚îÄ‚îÄ */
  .prop-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }
  .prop-field {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
    background: #e8eaf0;
  }
  .prop-field:nth-child(even) { border-right: none; }
  .prop-field:nth-last-child(-n+2) { border-bottom: none; }
  .prop-field-label {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text3);
    margin-bottom: 6px;
  }
  .prop-field-input {
    background: #e8eaf0;
    border: none;
    outline: none;
    color: #1a1f2e;
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 500;
    width: 100%;
  }
  .prop-field-input::placeholder { color: var(--text3); font-weight: 400; }

  /* ‚îÄ‚îÄ SHARE BTN ‚îÄ‚îÄ */
  .share-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 16px 20px;
    background: linear-gradient(to top, var(--bg) 60%, transparent);
    display: flex;
    gap: 10px;
    max-width: 600px;
    margin: 0 auto;
  }
  .calc-btn {
    flex: 1;
    padding: 14px;
    background: var(--accent);
    border: none;
    border-radius: 10px;
    color: white;
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: opacity 0.15s;
    letter-spacing: 0.02em;
  }
  .calc-btn:active { opacity: 0.8; }
  .share-btn {
    padding: 14px 20px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text2);
    font-family: var(--mono);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .share-btn:hover { border-color: var(--accent2); color: var(--accent2); }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(-20px);
    background: var(--accent2);
    color: var(--bg);
    font-family: var(--mono);
    font-size: 12px;
    padding: 10px 20px;
    border-radius: 8px;
    opacity: 0;
    transition: all 0.3s;
    pointer-events: none;
    z-index: 999;
    white-space: nowrap;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty {
    text-align: center;
    padding: 48px 20px;
    color: var(--text3);
    font-size: 13px;
  }
  .empty-icon { font-size: 36px; margin-bottom: 12px; }
  .empty-title {
    font-family: var(--display);
    font-size: 16px;
    font-weight: 700;
    color: var(--text2);
    margin-bottom: 6px;
  }

  /* ‚îÄ‚îÄ HEADER COL LABELS ‚îÄ‚îÄ */
  .unit-header {
    padding: 6px 16px;
    display: grid;
    grid-template-columns: 28px 1fr 90px 90px auto;
    gap: 6px;
  }
  .unit-header span {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text3);
  }

  .income-total-row {
    padding: 12px 16px;
    background: var(--surface2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid var(--border);
  }
  .income-total-label {
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text3);
  }
  .income-total-value {
    font-family: var(--mono);
    font-size: 15px;
    font-weight: 500;
    color: var(--accent2);
  }

  @media (max-width: 380px) {
    .results-grid { grid-template-columns: 1fr; }
    .result-value { font-size: 22px; }
  }
  /* ‚îÄ‚îÄ PASSWORD SCREEN ‚îÄ‚îÄ */
  #pw-screen {
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 32px;
  }
  #pw-screen.hidden { display: none; }
  .pw-logo {
    font-family: var(--display);
    font-weight: 800;
    font-size: 36px;
    letter-spacing: -1px;
    margin-bottom: 6px;
  }
  .pw-logo span { color: var(--accent); }
  .pw-tagline {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text3);
    letter-spacing: 0.08em;
    margin-bottom: 48px;
  }
  .pw-box {
    width: 100%;
    max-width: 320px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
  }
  .pw-box-inner { padding: 24px; }
  .pw-label {
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text3);
    margin-bottom: 10px;
  }
  .pw-input {
    width: 100%;
    background: #e8eaf0;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: #1a1f2e;
    font-family: var(--mono);
    font-size: 15px;
    font-weight: 500;
    padding: 12px 16px;
    outline: none;
    margin-bottom: 12px;
    transition: border-color 0.15s;
    -webkit-text-security: disc;
    letter-spacing: 0.1em;
  }
  .pw-input:focus { border-color: var(--accent); }
  .pw-input.error { border-color: var(--danger); animation: shake 0.3s ease; }
  .pw-btn {
    width: 100%;
    padding: 13px;
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: white;
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: opacity 0.15s;
    letter-spacing: 0.02em;
  }
  .pw-btn:active { opacity: 0.8; }
  .pw-error {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--danger);
    text-align: center;
    margin-top: 10px;
    min-height: 16px;
  }
  .pw-footer {
    margin-top: 48px;
    font-family: var(--mono);
    font-size: 10px;
    color: var(--text3);
    text-align: center;
    letter-spacing: 0.05em;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-6px); }
    75% { transform: translateX(6px); }
  }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ PASSWORD SCREEN ‚îÄ‚îÄ -->
<div id="pw-screen">
  <div class="pw-logo">Pocket<span>Broker</span></div>
  <div class="pw-tagline">deal analyzer ¬∑ members only</div>
  <div class="pw-box">
    <div class="pw-box-inner">
      <div class="pw-label">Enter Password</div>
      <input class="pw-input" id="pw-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
        onkeydown="if(event.key==='Enter')checkPassword()" autocomplete="current-password" />
      <button class="pw-btn" onclick="checkPassword()">Unlock ‚Üí</button>
      <div class="pw-error" id="pw-error"></div>
    </div>
  </div>
  <div class="pw-footer">Access restricted ¬∑ PocketBroker<br>
  <span style="margin-top:6px;display:block;">Built by <span style="color:var(--accent);">@TheGoogleGrad</span></span>
</div>
</div>

<div class="header">
  <div>
    <div class="logo">Pocket<span>Broker</span></div>
    <div class="tagline">deal analyzer</div>
  </div>
  <button class="reset-btn" onclick="resetAll()">‚Ü∫ Reset</button>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('income')">Income</div>
  <div class="tab" onclick="switchTab('expenses')">Expenses</div>
  <div class="tab" onclick="switchTab('debt')">Debt</div>
  <div class="tab" onclick="switchTab('results')">Results</div>
</div>

<div class="main">

  <!-- ‚ïê‚ïê INCOME PANEL ‚ïê‚ïê -->
  <div class="panel active" id="panel-income">

    <div class="section">
      <div class="section-header">
        <div class="section-title">Property Info</div>
      </div>
      <div class="prop-grid">
        <div class="prop-field">
          <div class="prop-field-label">Address</div>
          <input class="prop-field-input" id="prop-address" placeholder="123 Main St" />
        </div>
        <div class="prop-field">
          <div class="prop-field-label">City</div>
          <input class="prop-field-input" id="prop-city" placeholder="Los Angeles" />
        </div>
        <div class="prop-field">
          <div class="prop-field-label">Asking Price</div>
          <input class="prop-field-input" id="prop-price" type="number" placeholder="1,200,000" oninput="calculate()" />
        </div>
        <div class="prop-field">
          <div class="prop-field-label">Year Built</div>
          <input class="prop-field-input" id="prop-year" placeholder="1972" />
        </div>
        <div class="prop-field">
          <div class="prop-field-label">Building SF</div>
          <input class="prop-field-input" id="prop-bldg-sf" type="number" placeholder="4,500" oninput="calculate()" />
        </div>
        <div class="prop-field">
          <div class="prop-field-label">Land SF (Lot)</div>
          <input class="prop-field-input" id="prop-land-sf" type="number" placeholder="6,000" oninput="calculate()" />
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">Rental Units</div>
        <div class="section-badge" id="unit-count-badge">0 units</div>
      </div>
      <div class="global-increase-bar">
        <label class="apply-all-label">
          <input type="checkbox" id="apply-all-yr2" onchange="applyAllYr2()" />
          Apply % increase to all units
        </label>
        <div class="yr2-pct-wrap">
          <input type="number" id="global-yr2-pct" value="5" step="0.1" min="0" oninput="applyAllYr2()" />
          <span>% increase</span>
        </div>
        <span style="font-family:var(--mono);font-size:10px;color:var(--text3);margin-left:auto;">Year 2 rents</span>
      </div>
      <div class="unit-header">
        <span></span>
        <span>Unit Type</span>
        <span style="color:var(--text3);">Cur. Rent</span>
        <span style="color:var(--accent2);">Yr 2 Rent</span>
        <span></span>
      </div>
      <div id="units-list"></div>
      <button class="add-btn" onclick="addUnit()">Ôºã Add Unit</button>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">Other Income</div>
      </div>
      <div class="field">
        <div class="field-label">
          Laundry Income
          <small>Monthly</small>
        </div>
        <div class="field-input-wrap">
          <div class="field-prefix">$</div>
          <input type="number" id="laundry-income" placeholder="0" oninput="calculate()" />
        </div>
      </div>
      <div class="field">
        <div class="field-label">
          Parking Income
          <small>Monthly</small>
        </div>
        <div class="field-input-wrap">
          <div class="field-prefix">$</div>
          <input type="number" id="parking-income" placeholder="0" oninput="calculate()" />
        </div>
      </div>
      <div class="field">
        <div class="field-label">
          Vacancy Rate
          <small>% of gross income</small>
        </div>
        <div class="field-input-wrap">
          <input type="number" id="vacancy-rate" value="5" placeholder="5" oninput="calculate()" />
          <div class="field-suffix">%</div>
        </div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê EXPENSES PANEL ‚ïê‚ïê -->
  <div class="panel" id="panel-expenses">

    <div class="section">
      <div class="section-header">
        <div class="section-title">Default Expenses</div>
        <div class="section-badge">Toggle on/off</div>
      </div>
      <div id="default-expenses-list"></div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">Custom Expenses</div>
        <div class="section-badge" id="custom-count">0 added</div>
      </div>
      <div id="custom-expenses-list"></div>
      <button class="add-btn" onclick="addCustomExpense()">Ôºã Add Custom Expense</button>
    </div>

  </div>

  <!-- ‚ïê‚ïê DEBT PANEL ‚ïê‚ïê -->
  <div class="panel" id="panel-debt">

    <div class="section">
      <div class="section-header">
        <div class="section-title">Loan Assumptions</div>
        <div class="loan-toggle-row" style="padding:0;border:none;" onclick="toggleDebt()">
          <div style="display:flex;align-items:center;gap:8px;">
            <div class="toggle" id="debt-toggle"></div>
            <span style="font-size:12px;color:var(--text3);font-family:var(--mono);">Include debt service</span>
          </div>
        </div>
      </div>
      <div id="debt-fields">
        <div class="field">
          <div class="field-label">Down Payment<small>% of purchase price</small></div>
          <div class="field-input-wrap">
            <input type="number" id="down-pct" value="25" placeholder="25" oninput="calculate()" />
            <div class="field-suffix">%</div>
          </div>
        </div>
        <div class="field" style="background:var(--surface2);">
          <div class="field-label">
            Down Payment Amount
            <small>Cash required at close</small>
          </div>
          <div style="font-family:var(--mono);font-size:15px;font-weight:600;color:var(--accent3);" id="down-amt-display">‚Äî</div>
        </div>
        <div class="field" style="background:var(--surface2);">
          <div class="field-label">
            Loan Balance
            <small>After down payment</small>
          </div>
          <div style="font-family:var(--mono);font-size:15px;font-weight:600;color:var(--accent);" id="loan-bal-display">‚Äî</div>
        </div>
        <div class="field">
          <div class="field-label">Interest Rate<small>Annual</small></div>
          <div class="field-input-wrap">
            <input type="number" id="int-rate" value="6.5" step="0.1" placeholder="6.5" oninput="calculate()" />
            <div class="field-suffix">%</div>
          </div>
        </div>
        <div class="field">
          <div class="field-label">Amortization<small>Years</small></div>
          <div class="field-input-wrap">
            <input type="number" id="amort-years" value="30" placeholder="30" oninput="calculate()" />
            <div class="field-suffix">yrs</div>
          </div>
        </div>
        <div class="field" style="background:var(--surface2);">
          <div class="field-label">
            Monthly Payment
            <small>Principal + Interest</small>
          </div>
          <div style="font-family:var(--mono);font-size:15px;font-weight:600;color:var(--accent3);" id="monthly-payment-display">‚Äî</div>
        </div>
        <div class="field" style="background:var(--surface2);">
          <div class="field-label">
            Annual Debt Service
            <small>Total yearly payments</small>
          </div>
          <div style="font-family:var(--mono);font-size:15px;font-weight:600;color:var(--accent3);" id="annual-debt-display">‚Äî</div>
        </div>
        <div class="field" style="background:var(--surface2);border-bottom:none;">
          <div class="field-label">
            DSCR
            <small>Debt Service Coverage Ratio</small>
          </div>
          <div style="display:flex;align-items:center;gap:10px;">
            <div style="font-family:var(--mono);font-size:15px;font-weight:600;" id="dscr-display">‚Äî</div>
            <div id="dscr-badge" style="font-family:var(--mono);font-size:10px;padding:3px 8px;border-radius:4px;display:none;"></div>
          </div>
        </div>
        <div style="padding:12px 16px;background:var(--surface2);border-top:1px solid var(--border);">
          <div style="font-family:var(--mono);font-size:10px;color:var(--text3);line-height:1.6;">
            DSCR = NOI √∑ Annual Debt Service<br>
            <span style="color:var(--accent2);">‚â• 1.25x</span> ‚Äî lender approved &nbsp;¬∑&nbsp;
            <span style="color:var(--accent3);">1.00‚Äì1.24x</span> ‚Äî tight &nbsp;¬∑&nbsp;
            <span style="color:var(--danger);">&lt; 1.00x</span> ‚Äî negative coverage
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê RESULTS PANEL ‚ïê‚ïê -->
  <div class="panel" id="panel-results">
    <div id="results-content">
      <div class="empty">
        <div class="empty-icon">üè¢</div>
        <div class="empty-title">No data yet</div>
        Add units and an asking price to see your numbers
      </div>
    </div>
  </div>

</div>

<!-- Share bar -->
<div class="share-bar">
  <button class="calc-btn" onclick="switchTab('results')">‚Üí View Results</button>
  <button class="share-btn" onclick="copySnapshot()">‚¨° Copy</button>
</div>

<div class="toast" id="toast"></div>
<div style="text-align:center;padding:8px;font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:0.05em;padding-bottom:100px;">
  Built by <span style="color:var(--accent);">@TheGoogleGrad</span>
</div>

<script>
// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let units = [];
let unitId = 0;
let debtEnabled = false;

const defaultExpenses = [
  { id: 'taxes',    name: 'Property Taxes',       value: 1.2,   type: 'pct',    on: true,  note: '% of price/yr' },
  { id: 'assessments', name: 'Special Assessments',   value: 0,    type: 'flat',   on: false, note: 'annual $' },
  { id: 'insurance',name: 'Insurance',             value: 900,   type: 'per_unit', on: true, note: 'per unit/yr' },
  { id: 'mgmt',     name: 'Property Management',   value: 8,     type: 'pct_income', on: true, note: '% of income' },
  { id: 'repairs',  name: 'Repairs & Maintenance', value: 750,   type: 'per_unit', on: true, note: 'per unit/yr' },
  { id: 'utilities',name: 'Utilities',              value: 900,   type: 'per_unit', on: false, note: 'per unit/yr' },
  { id: 'gardener', name: 'Gardener / Landscaping', value: 100,  type: 'per_month', on: false, note: '$/month' },
  { id: 'pest',     name: 'Pest Control',           value: 75,   type: 'per_month', on: false, note: '$/month' },
  { id: 'reserves', name: 'Reserves',               value: 250,  type: 'per_unit', on: true,  note: 'per unit/yr' },
];

let customExpenses = [];
let customId = 0;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
function init() {
  addUnit();
  addUnit();
  renderDefaultExpenses();
  renderDebtToggle();
  calculate();
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach((t,i) => {
    t.classList.toggle('active', ['income','expenses','debt','results'][i] === tab);
  });
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
  if (tab === 'results') calculate();
}

// ‚îÄ‚îÄ UNITS ‚îÄ‚îÄ
function addUnit() {
  const id = ++unitId;
  units.push({ id, type: '', rent: '', rent2: '' });
  renderUnits();
  calculate();
}

function removeUnit(id) {
  units = units.filter(u => u.id !== id);
  renderUnits();
  calculate();
}

function renderUnits() {
  const list = document.getElementById('units-list');
  if (units.length === 0) {
    list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3);font-size:13px;">No units added yet</div>';
    document.getElementById('unit-count-badge').textContent = '0 units';
    return;
  }
  const applyAll = document.getElementById('apply-all-yr2')?.checked;
  const globalPct = parseFloat(document.getElementById('global-yr2-pct')?.value) || 5;
  list.innerHTML = units.map((u, i) => {
    const idx = units.indexOf(u);
    const yr2val = applyAll && u.rent ? Math.round(parseFloat(u.rent) * (1 + globalPct/100)) : (u.rent2 || '');
    return `
    <div class="unit-row">
      <div class="unit-num">${i+1}</div>
      <select class="unit-select" onchange="units[${idx}].type=this.value;calculate()">
        <option value="" ${!u.type?'selected':''}>‚Äî Select ‚Äî</option>
        <option value="Studio" ${u.type==="Studio"?"selected":""}>Studio</option><option value="1 Bed / 1 Bath" ${u.type==="1 Bed / 1 Bath"?"selected":""}>1 Bed / 1 Bath</option><option value="2 Bed / 1 Bath" ${u.type==="2 Bed / 1 Bath"?"selected":""}>2 Bed / 1 Bath</option><option value="2 Bed / 2 Bath" ${u.type==="2 Bed / 2 Bath"?"selected":""}>2 Bed / 2 Bath</option><option value="3 Bed / 1 Bath" ${u.type==="3 Bed / 1 Bath"?"selected":""}>3 Bed / 1 Bath</option><option value="3 Bed / 2 Bath" ${u.type==="3 Bed / 2 Bath"?"selected":""}>3 Bed / 2 Bath</option><option value="3 Bed / 3 Bath" ${u.type==="3 Bed / 3 Bath"?"selected":""}>3 Bed / 3 Bath</option><option value="4 Bed / 2 Bath" ${u.type==="4 Bed / 2 Bath"?"selected":""}>4 Bed / 2 Bath</option><option value="4 Bed / 3 Bath" ${u.type==="4 Bed / 3 Bath"?"selected":""}>4 Bed / 3 Bath</option><option value="Commercial" ${u.type==="Commercial"?"selected":""}>Commercial</option><option value="Retail" ${u.type==="Retail"?"selected":""}>Retail</option><option value="Office" ${u.type==="Office"?"selected":""}>Office</option>
      </select>
      <div style="position:relative;display:flex;align-items:center;">
        <span style="position:absolute;left:8px;font-family:var(--mono);font-size:12px;color:var(--text3);">$</span>
        <input class="unit-input" type="number" placeholder="1,500" value="${u.rent}"
          style="padding-left:18px;height:34px;font-size:12px;"
          oninput="units[${idx}].rent=this.value;if(document.getElementById('apply-all-yr2').checked){applyAllYr2();}else{calculate();}" />
      </div>
      <div style="position:relative;display:flex;align-items:center;">
        <span style="position:absolute;left:6px;font-family:var(--mono);font-size:11px;color:rgba(56,217,169,0.5);z-index:1;">$</span>
        <input class="yr2-input" type="number" placeholder="‚Äî" value="${yr2val}"
          ${applyAll ? 'disabled' : ''}
          oninput="units[${idx}].rent2=this.value;calculate()" />
      </div>
      <button class="unit-remove" onclick="removeUnit(${u.id})">√ó</button>
    </div>
  `}).join('');
  document.getElementById('unit-count-badge').textContent = `${units.length} unit${units.length !== 1 ? 's' : ''}`;
}

// ‚îÄ‚îÄ YEAR 2 APPLY ALL ‚îÄ‚îÄ
function applyAllYr2() {
  const applyAll = document.getElementById('apply-all-yr2')?.checked;
  const globalPct = parseFloat(document.getElementById('global-yr2-pct')?.value) || 5;
  if (applyAll) {
    units.forEach(u => {
      if (u.rent) u.rent2 = Math.round(parseFloat(u.rent) * (1 + globalPct/100));
    });
  }
  renderUnits();
  calculate();
}

// ‚îÄ‚îÄ DEFAULT EXPENSES ‚îÄ‚îÄ
function renderDefaultExpenses() {
  const list = document.getElementById('default-expenses-list');
  list.innerHTML = defaultExpenses.map((e, i) => `
    <div class="expense-row">
      <div class="expense-toggle" onclick="toggleDefaultExpense(${i})">
        <div class="toggle ${e.on ? 'on' : ''}" id="toggle-${e.id}"></div>
        <span class="expense-name ${e.on ? '' : 'off'}" id="ename-${e.id}">${e.name}</span>
      </div>
      <input class="expense-input" type="number" value="${e.value}"
        step="${e.id === 'taxes' ? '0.01' : 'any'}"
        oninput="defaultExpenses[${i}].value=parseFloat(this.value)||0;calculate()"
        onblur="if('${e.id}'==='taxes'){const v=parseFloat(this.value);if(!isNaN(v)){this.value=v.toFixed(2);defaultExpenses[${i}].value=parseFloat(this.value);}}"
        ${e.on ? '' : 'disabled style="opacity:0.3"'} />
      <span style="font-family:var(--mono);font-size:10px;color:var(--text3);white-space:nowrap;">${e.note}</span>
      <div style="width:8px;"></div>
    </div>
  `).join('');
}

function toggleDefaultExpense(i) {
  defaultExpenses[i].on = !defaultExpenses[i].on;
  renderDefaultExpenses();
  calculate();
}

// ‚îÄ‚îÄ CUSTOM EXPENSES ‚îÄ‚îÄ
function addCustomExpense() {
  customExpenses.push({ id: ++customId, name: '', value: 0, type: 'flat' });
  renderCustomExpenses();
}

function removeCustomExpense(id) {
  customExpenses = customExpenses.filter(e => e.id !== id);
  renderCustomExpenses();
  calculate();
}

function renderCustomExpenses() {
  const list = document.getElementById('custom-expenses-list');
  document.getElementById('custom-count').textContent = `${customExpenses.length} added`;
  if (customExpenses.length === 0) {
    list.innerHTML = '<div style="padding:16px;text-align:center;color:var(--text3);font-size:12px;font-family:var(--mono);">No custom expenses yet</div>';
    return;
  }
  list.innerHTML = customExpenses.map((e, i) => `
    <div class="expense-row">
      <input class="expense-input" placeholder="Expense name" value="${e.name}"
        oninput="customExpenses[${i}].name=this.value" style="min-width:0;" />
      <div style="position:relative;display:flex;align-items:center;">
        <span style="position:absolute;left:8px;font-family:var(--mono);font-size:12px;color:var(--text3);">$</span>
        <input class="expense-input" type="number" placeholder="0" value="${e.value||''}"
          style="padding-left:20px;"
          oninput="customExpenses[${i}].value=parseFloat(this.value)||0;calculate()" />
      </div>
      <span style="font-family:var(--mono);font-size:10px;color:var(--text3);">annual</span>
      <button class="expense-remove" onclick="removeCustomExpense(${e.id})">√ó</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ DEBT ‚îÄ‚îÄ
function toggleDebt() {
  debtEnabled = !debtEnabled;
  renderDebtToggle();
  calculate();
}

function renderDebtToggle() {
  const t = document.getElementById('debt-toggle');
  if (t) t.className = `toggle ${debtEnabled ? 'on' : ''}`;
}

function calcMonthlyPayment(principal, annualRate, years) {
  if (!principal || !annualRate || !years) return 0;
  const r = annualRate / 100 / 12;
  const n = years * 12;
  if (r === 0) return principal / n;
  return principal * r * Math.pow(1+r, n) / (Math.pow(1+r, n) - 1);
}

// ‚îÄ‚îÄ MAIN CALCULATE ‚îÄ‚îÄ
function calculate() {
  const price = parseFloat(document.getElementById('prop-price').value) || 0;
  const bldgSF = parseFloat(document.getElementById('prop-bldg-sf').value) || 0;
  const landSF = parseFloat(document.getElementById('prop-land-sf').value) || 0;
  const otherIncome = (parseFloat(document.getElementById('laundry-income').value) || 0) + (parseFloat(document.getElementById('parking-income').value) || 0);
  const vacancyPct = parseFloat(document.getElementById('vacancy-rate').value) || 5;

  // Monthly rent ‚Äî current
  const monthlyRent = units.reduce((s, u) => s + (parseFloat(u.rent) || 0), 0);
  const grossMonthly = monthlyRent + otherIncome;
  const grossAnnual = grossMonthly * 12;
  const vacancyLoss = grossAnnual * (vacancyPct / 100);
  const effectiveGross = grossAnnual - vacancyLoss;

  // Monthly rent ‚Äî year 2
  const hasYr2 = units.some(u => u.rent2 && parseFloat(u.rent2) > 0);
  const monthlyRentYr2 = hasYr2 ? units.reduce((s, u) => s + (parseFloat(u.rent2) || parseFloat(u.rent) || 0), 0) : 0;
  const grossMonthlyYr2 = monthlyRentYr2 + otherIncome;
  const grossAnnualYr2 = grossMonthlyYr2 * 12;
  const vacancyLossYr2 = grossAnnualYr2 * (vacancyPct / 100);
  const effectiveGrossYr2 = grossAnnualYr2 - vacancyLossYr2;

  // Expenses
  const numUnits = units.length || 1;
  let totalExpenses = 0;

  defaultExpenses.forEach(e => {
    if (!e.on) return;
    let amt = 0;
    if (e.type === 'pct') amt = price * (e.value / 100);
    else if (e.type === 'per_unit') amt = e.value * numUnits;
    else if (e.type === 'pct_income') amt = effectiveGross * (e.value / 100);
    else if (e.type === 'per_month') amt = e.value * 12;
    else if (e.type === 'flat') amt = e.value;
    totalExpenses += amt;
  });

  customExpenses.forEach(e => { totalExpenses += (e.value || 0); });

  const noi = effectiveGross - totalExpenses;
  const noiYr2 = hasYr2 ? effectiveGrossYr2 - totalExpenses : null;
  const capRate = price > 0 ? (noi / price) * 100 : 0;
  const capRateYr2 = (hasYr2 && price > 0) ? (noiYr2 / price) * 100 : null;
  const grm = grossAnnual > 0 ? price / grossAnnual : 0;
  const expenseRatio = effectiveGross > 0 ? (totalExpenses / effectiveGross) * 100 : 0;

  // Debt
  const downPct = parseFloat(document.getElementById('down-pct').value) || 25;
  const intRate = parseFloat(document.getElementById('int-rate').value) || 6.5;
  const amortYears = parseFloat(document.getElementById('amort-years').value) || 30;
  const loanAmt = price * (1 - downPct / 100);
  const monthlyPayment = calcMonthlyPayment(loanAmt, intRate, amortYears);
  const annualDebt = monthlyPayment * 12;
  const cashFlow = debtEnabled ? noi - annualDebt : null;
  const cashFlowYr2 = (hasYr2 && debtEnabled) ? noiYr2 - annualDebt : null;
  const dcr = annualDebt > 0 ? noi / annualDebt : null;
  const downPayment = price * (downPct / 100);
  const coc = (debtEnabled && downPayment > 0) ? (cashFlow / downPayment) * 100 : null;

  // Update down payment amount and loan balance displays
  const downAmtDisplay = document.getElementById('down-amt-display');
  const loanBalDisplay = document.getElementById('loan-bal-display');
  if (downAmtDisplay) downAmtDisplay.textContent = price > 0 ? '$' + fmt(downPayment) : '‚Äî';
  if (loanBalDisplay) loanBalDisplay.textContent = price > 0 ? '$' + fmt(loanAmt) : '‚Äî';

  // Update monthly payment display
  const mpDisplay = document.getElementById('monthly-payment-display');
  if (mpDisplay) mpDisplay.textContent = price > 0 ? '$' + fmt(monthlyPayment) : '‚Äî';

  // Update annual debt service display
  const adDisplay = document.getElementById('annual-debt-display');
  if (adDisplay) adDisplay.textContent = price > 0 ? '$' + fmt(annualDebt) + '/yr' : '‚Äî';

  // Update DSCR display on debt tab
  const dscrDisplay = document.getElementById('dscr-display');
  const dscrBadge = document.getElementById('dscr-badge');
  if (dscrDisplay) {
    const dscrVal = (annualDebt > 0 && noi > 0) ? noi / annualDebt : null;
    if (dscrVal) {
      dscrDisplay.textContent = dscrVal.toFixed(2) + 'x';
      if (dscrVal >= 1.25) {
        dscrDisplay.style.color = 'var(--accent2)';
        dscrBadge.style.display = 'block';
        dscrBadge.style.background = 'rgba(56,217,169,0.15)';
        dscrBadge.style.color = 'var(--accent2)';
        dscrBadge.textContent = '‚úì Approved';
      } else if (dscrVal >= 1.0) {
        dscrDisplay.style.color = 'var(--accent3)';
        dscrBadge.style.display = 'block';
        dscrBadge.style.background = 'rgba(247,201,72,0.15)';
        dscrBadge.style.color = 'var(--accent3)';
        dscrBadge.textContent = '‚ö† Tight';
      } else {
        dscrDisplay.style.color = 'var(--danger)';
        dscrBadge.style.display = 'block';
        dscrBadge.style.background = 'rgba(247,110,110,0.15)';
        dscrBadge.style.color = 'var(--danger)';
        dscrBadge.textContent = '‚úó Below 1.0';
      }
    } else {
      dscrDisplay.textContent = '‚Äî';
      dscrDisplay.style.color = 'var(--text2)';
      if (dscrBadge) dscrBadge.style.display = 'none';
    }
  }

  // Render results
  renderResults({
    price, grossMonthly, grossAnnual, vacancyLoss, effectiveGross,
    totalExpenses, noi, capRate, grm, expenseRatio,
    annualDebt, cashFlow, dcr, coc, downPayment, loanAmt,
    monthlyPayment, numUnits, bldgSF, landSF,
    hasYr2, grossMonthlyYr2, grossAnnualYr2, vacancyLossYr2, effectiveGrossYr2, noiYr2, capRateYr2, cashFlowYr2
  });
}

function fmt(n) {
  if (!n && n !== 0) return '‚Äî';
  return Math.abs(n).toLocaleString('en-US', { maximumFractionDigits: 0 });
}
function fmtSigned(n) {
  if (n === null || n === undefined) return '‚Äî';
  const sign = n < 0 ? '-' : '+';
  return sign + '$' + fmt(n);
}
function fmtPct(n) {
  if (!n && n !== 0) return '‚Äî';
  return n.toFixed(2) + '%';
}
function fmtX(n) {
  if (!n && n !== 0) return '‚Äî';
  return n.toFixed(2) + 'x';
}

function renderResults(d) {
  const el = document.getElementById('results-content');

  if (!d.price && !d.grossAnnual) {
    el.innerHTML = `<div class="empty"><div class="empty-icon">üè¢</div><div class="empty-title">No data yet</div>Add units and an asking price to see your numbers</div>`;
    return;
  }

  const addr = document.getElementById('prop-address').value;
  const city = document.getElementById('prop-city').value;
  const propName = addr ? `${addr}${city ? ', ' + city : ''}` : 'Property Analysis';

  el.innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="font-family:var(--display);font-weight:800;font-size:18px;letter-spacing:-0.5px;color:var(--text);margin-bottom:2px;">${propName}</div>
      <div style="font-family:var(--mono);font-size:11px;color:var(--text3);">${d.numUnits} unit${d.numUnits !== 1 ? 's' : ''} ¬∑ asking ${d.price ? '$' + fmt(d.price) : 'N/A'}</div>
    </div>

    <div class="results-grid">
      <div class="result-card blue">
        <div class="result-label">Cap Rate</div>
        <div class="result-value">${d.capRate ? fmtPct(d.capRate) : '‚Äî'}</div>
        <div class="result-sub">NOI / Price</div>
      </div>
      <div class="result-card green">
        <div class="result-label">NOI</div>
        <div class="result-value">${d.noi ? '$' + fmt(d.noi) : '‚Äî'}</div>
        <div class="result-sub">Annual</div>
      </div>
      <div class="result-card gold">
        <div class="result-label">GRM</div>
        <div class="result-value">${d.grm ? fmtX(d.grm) : '‚Äî'}</div>
        <div class="result-sub">Price / Gross Rent</div>
      </div>
      <div class="result-card ${debtEnabled ? (d.cashFlow >= 0 ? 'green' : 'red') : 'blue'}">
        <div class="result-label">Cash Flow</div>
        <div class="result-value">${debtEnabled ? fmtSigned(d.cashFlow) : 'N/A'}</div>
        <div class="result-sub">${debtEnabled ? 'Annual after debt' : 'Enable debt tab'}</div>
      </div>
    </div>

    ${debtEnabled && d.dcr ? `
    <div class="results-grid" style="margin-top:-4px;">
      <div class="result-card ${d.dcr >= 1.25 ? 'green' : 'red'}">
        <div class="result-label">Debt Coverage</div>
        <div class="result-value">${fmtX(d.dcr)}</div>
        <div class="result-sub">${d.dcr >= 1.25 ? '‚úì Lender approved' : '‚úó Below 1.25x'}</div>
      </div>
      <div class="result-card blue">
        <div class="result-label">Cash-on-Cash</div>
        <div class="result-value">${d.coc !== null ? fmtPct(d.coc) : '‚Äî'}</div>
        <div class="result-sub">Return on equity</div>
      </div>
    </div>` : ''}

    <div class="results-grid" style="margin-top:-4px;">
      <div class="result-card gold">
        <div class="result-label">Price / Unit</div>
        <div class="result-value">${d.price && d.numUnits ? '$' + fmt(d.price / d.numUnits) : '‚Äî'}</div>
        <div class="result-sub">Per door</div>
      </div>
      <div class="result-card blue">
        <div class="result-label">Price / Bldg SF</div>
        <div class="result-value">${d.bldgSF ? '$' + (d.price / d.bldgSF).toFixed(0) : '‚Äî'}</div>
        <div class="result-sub">${d.bldgSF ? d.bldgSF.toLocaleString() + ' sf' : 'Enter bldg sf'}</div>
      </div>
      <div class="result-card green">
        <div class="result-label">Price / Land SF</div>
        <div class="result-value">${d.landSF ? '$' + (d.price / d.landSF).toFixed(0) : '‚Äî'}</div>
        <div class="result-sub">${d.landSF ? d.landSF.toLocaleString() + ' sf' : 'Enter land sf'}</div>
      </div>
      <div class="result-card blue">
        <div class="result-label">$/SF ¬∑ $/Unit</div>
        <div class="result-value" style="font-size:16px;">${d.bldgSF && d.numUnits ? fmt(d.bldgSF / d.numUnits) + ' sf' : '‚Äî'}</div>
        <div class="result-sub">Avg SF per unit</div>
      </div>
    </div>

    ${d.hasYr2 ? `
    <div style="margin-bottom:16px;">
      <div style="font-family:var(--display);font-weight:700;font-size:11px;text-transform:uppercase;letter-spacing:0.08em;color:var(--text3);margin-bottom:10px;padding:0 2px;">Year 2 Comparison</div>
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;border-bottom:1px solid var(--border);">
          <div style="padding:8px 12px;font-family:var(--mono);font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:0.06em;border-right:1px solid var(--border);">Metric</div>
          <div style="padding:8px 12px;font-family:var(--mono);font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:0.06em;border-right:1px solid var(--border);">Current</div>
          <div style="padding:8px 12px;font-family:var(--mono);font-size:10px;color:var(--accent2);text-transform:uppercase;letter-spacing:0.06em;">Year 2</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;border-bottom:1px solid var(--border);">
          <div style="padding:10px 12px;font-size:12px;color:var(--text2);border-right:1px solid var(--border);">Gross Rent/mo</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--text);border-right:1px solid var(--border);">$${fmt(d.grossMonthly)}</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--accent2);">$${fmt(d.grossMonthlyYr2)}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;border-bottom:1px solid var(--border);">
          <div style="padding:10px 12px;font-size:12px;color:var(--text2);border-right:1px solid var(--border);">Eff. Gross/yr</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--text);border-right:1px solid var(--border);">$${fmt(d.effectiveGross)}</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--accent2);">$${fmt(d.effectiveGrossYr2)}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;border-bottom:1px solid var(--border);">
          <div style="padding:10px 12px;font-size:12px;color:var(--text2);border-right:1px solid var(--border);">NOI</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--text);border-right:1px solid var(--border);">$${fmt(d.noi)}</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--accent2);">$${fmt(d.noiYr2)}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;${d.cashFlowYr2 !== null ? 'border-bottom:1px solid var(--border);' : ''}">
          <div style="padding:10px 12px;font-size:12px;color:var(--text2);border-right:1px solid var(--border);">Cap Rate</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--text);border-right:1px solid var(--border);">${fmtPct(d.capRate)}</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--accent2);">${fmtPct(d.capRateYr2)}</div>
        </div>
        ${d.cashFlowYr2 !== null ? `
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;">
          <div style="padding:10px 12px;font-size:12px;color:var(--text2);border-right:1px solid var(--border);">Cash Flow</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--text);border-right:1px solid var(--border);">${fmtSigned(d.cashFlow)}</div>
          <div style="padding:10px 12px;font-family:var(--mono);font-size:12px;color:var(--accent2);">${fmtSigned(d.cashFlowYr2)}</div>
        </div>` : ''}
      </div>
    </div>` : ''}

    <div class="waterfall">
      <div class="wf-row" style="background:var(--surface2);">
        <div class="wf-label" style="font-family:var(--display);font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:0.05em;">Income & Expense Waterfall</div>
        <div></div>
      </div>
      <div class="wf-row">
        <div class="wf-label">Gross Scheduled Income</div>
        <div class="wf-value">$${fmt(d.grossAnnual)}/yr</div>
      </div>
      <div class="wf-row">
        <div class="wf-label indent">Less: Vacancy (${document.getElementById('vacancy-rate').value || 5}%)</div>
        <div class="wf-value neg">-$${fmt(d.vacancyLoss)}</div>
      </div>
      <div class="wf-row total">
        <div class="wf-label">Effective Gross Income</div>
        <div class="wf-value highlight">$${fmt(d.effectiveGross)}</div>
      </div>
      <div class="wf-row">
        <div class="wf-label indent">Less: Total Expenses (${d.expenseRatio.toFixed(0)}%)</div>
        <div class="wf-value neg">-$${fmt(d.totalExpenses)}</div>
      </div>
      <div class="wf-row total">
        <div class="wf-label">Net Operating Income</div>
        <div class="wf-value pos">$${fmt(d.noi)}</div>
      </div>
      ${debtEnabled ? `
      <div class="wf-row">
        <div class="wf-label indent">Less: Debt Service</div>
        <div class="wf-value neg">-$${fmt(d.annualDebt)}</div>
      </div>
      <div class="wf-row total">
        <div class="wf-label">Cash Flow Before Tax</div>
        <div class="wf-value ${d.cashFlow >= 0 ? 'pos' : 'neg'}">${fmtSigned(d.cashFlow)}</div>
      </div>` : ''}
    </div>

    ${d.price ? `
    <div class="section">
      <div class="section-header"><div class="section-title">Deal Metrics</div></div>
      <div class="wf-row"><div class="wf-label">Gross Monthly Income</div><div class="wf-value">$${fmt(d.grossMonthly)}/mo</div></div>
      <div class="wf-row"><div class="wf-label">Expense Ratio</div><div class="wf-value">${d.expenseRatio.toFixed(1)}%</div></div>
      ${debtEnabled ? `
      <div class="wf-row"><div class="wf-label">Down Payment</div><div class="wf-value">$${fmt(d.downPayment)}</div></div>
      <div class="wf-row"><div class="wf-label">Loan Amount</div><div class="wf-value">$${fmt(d.loanAmt)}</div></div>
      <div class="wf-row"><div class="wf-label">Monthly Payment</div><div class="wf-value">$${fmt(d.monthlyPayment)}/mo</div></div>
      ` : ''}
    </div>` : ''}
  `;
}

// ‚îÄ‚îÄ COPY SNAPSHOT ‚îÄ‚îÄ
function copySnapshot() {
  const addr = document.getElementById('prop-address').value || 'Property';
  const price = document.getElementById('prop-price').value;
  const noi = document.getElementById('results-content').querySelector('.result-card.green .result-value')?.textContent;
  const cap = document.getElementById('results-content').querySelector('.result-card.blue .result-value')?.textContent;
  const grm = document.getElementById('results-content').querySelector('.result-card.gold .result-value')?.textContent;

  const lines = [
    `üìä DEAL SNAPSHOT ‚Äî ${addr}`,
    `Asking: $${price ? Number(price).toLocaleString() : 'N/A'}`,
    `NOI: ${noi || '‚Äî'}`,
    `Cap Rate: ${cap || '‚Äî'}`,
    `GRM: ${grm || '‚Äî'}`,
    `Units: ${units.length}`,
    `Monthly Rent: $${fmt(units.reduce((s,u) => s + (parseFloat(u.rent)||0), 0))}`,
    `Generated by PocketBroker`
  ];

  navigator.clipboard.writeText(lines.join('\n')).then(() => showToast('‚úì Snapshot copied!'));
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

function resetAll() {
  if (!confirm('Reset all data?')) return;
  units = []; unitId = 0; customExpenses = []; customId = 0; debtEnabled = false;
  document.getElementById('prop-address').value = '';
  document.getElementById('prop-city').value = '';
  document.getElementById('prop-price').value = '';
  document.getElementById('prop-year').value = '';
  document.getElementById('prop-bldg-sf').value = '';
  document.getElementById('prop-land-sf').value = '';
  document.getElementById('laundry-income').value = '';
  document.getElementById('parking-income').value = '';
  document.getElementById('vacancy-rate').value = '5';
  defaultExpenses.forEach(e => {
    if (['taxes','insurance','mgmt','repairs','reserves'].includes(e.id)) e.on = true;
    else e.on = false;
  });
  init();
  switchTab('income');
  showToast('‚Ü∫ Reset complete');
}

init();
renderCustomExpenses();
</script>
<script>
// ‚îÄ‚îÄ PASSWORD ‚îÄ‚îÄ
(function() {
  const HASH = '7f7d40a3e9a9c6d8b1f2e4a5c3d6b8e2f1a4c7d9e0b3f5a2c8d1e6b4f7a0c3';
  // Simple check ‚Äî compare against stored session
  if (sessionStorage.getItem('pb_auth') === '1') {
    document.getElementById('pw-screen').classList.add('hidden');
  }
})();

function checkPassword() {
  const val = document.getElementById('pw-input').value;
  const input = document.getElementById('pw-input');
  const err = document.getElementById('pw-error');
  if (val === 'Moneyteam') {
    sessionStorage.setItem('pb_auth', '1');
    document.getElementById('pw-screen').classList.add('hidden');
    err.textContent = '';
  } else {
    input.classList.add('error');
    err.textContent = 'Incorrect password. Try again.';
    setTimeout(() => input.classList.remove('error'), 400);
    input.value = '';
    input.focus();
  }
}

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('pocketbroker-sw.js').then(reg => {
      console.log('PocketBroker SW registered');
    }).catch(err => console.log('SW registration failed:', err));
  });
}
</script>
</body>
</html>
